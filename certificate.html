<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Certificate of Appreciation from Sahajshakti Sarvakalyaan Trust">
    <title>Certificate of Appreciation - Sahajshakti Sarvakalyaan Trust</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Noto+Sans:wght@400;500;700&family=Cinzel:wght@700&family=Great+Vibes&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
            margin: 0;
        }

        .certificate-container {
            background: white;
            border: 15px solid #D4AF37;
            border-image: linear-gradient(45deg, #D4AF37, #F4C430, #D4AF37) 1;
            padding: 2.5rem;
            max-width: 850px;
            width: 100%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            text-align: center;
            position: relative;
            background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCI+PHBhdGggZD0iTTUwIDUwQzY1IDE1IDg1IDM1IDg1IDUwQzkgNjUgNjUgODUgNTAgODVDMzUgODUgMTUgNjUgMzUgNTBDMTUgMzUgNjUgMTUgNTAgNTBaIiBmaWxsPSIjRkZGRkZGIiBmaWxsLW9wYWNpdHk9IjAuMDUiLz48L3N2Zz4=');
            background-repeat: repeat;
            background-size: 120px 120px;
        }

        .certificate-container::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 2px solid rgba(212, 175, 55, 0.3);
            pointer-events: none;
        }

        .logo-placeholder {
            width: 120px;
            height: 80px;
            margin: 0 auto 1rem;
            object-fit: contain;
        }

        .certificate-title {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 0.5rem;
            letter-spacing: 1px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .certificate-subtitle {
            font-family: 'Noto Sans', sans-serif;
            font-size: 1.1rem;
            color: #7f8c8d;
            margin-bottom: 1.5rem;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .certificate-text {
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            color: #34495e;
            margin-bottom: 1.5rem;
            line-height: 1.8;
            max-width: 90%;
            margin-left: auto;
            margin-right: auto;
        }

        .donor-name {
            font-family: 'Great Vibes', cursive;
            font-size: 3.5rem;
            margin: 1rem 0;
            display: block;
            color: #D4AF37;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }

        .donation-amount {
            font-family: 'Noto Sans', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            /* margin: 1.5rem 0; */ /* Adjusted margin for Payment ID */
            margin-top: 1.5rem;
            margin-bottom: 0.25rem; /* Reduced bottom margin */
            display: block;
            color: #27ae60;
            letter-spacing: 0.5px;
        }

        /* New style for Payment ID */
        .payment-id-details {
            font-family: 'Poppins', sans-serif;
            font-size: 0.9rem;
            color: #555555; /* Darker gray for readability */
            margin-top: 0.25rem; /* Space between amount and Payment ID */
            margin-bottom: 1.5rem; /* Space after Payment ID, before next text block */
            letter-spacing: 0.5px;
        }

        .certificate-footer {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-top: 2rem;
            padding: 1rem;
            border-top: 1px solid #ecf0f1;
        }

        .signature-container {
            margin: 2rem auto;
            text-align: center;
            width: 100%;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .signature-image {
            width: 180px;
            height: 60px;
            object-fit: contain;
            margin: 0 auto 0.5rem;
            display: block;
        }

        .signature-line {
            width: 200px;
            height: 1px;
            background: #D4AF37;
            margin: 0.5rem auto;
        }

        .ngo-name {
            font-family: 'Noto Sans', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            color: #D4AF37;
            margin-top: 0.5rem;
        }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        .action-button {
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn-print {
            background: linear-gradient(to right, #3498db, #2ecc71);
            color: white;
        }

        .btn-download {
            background: linear-gradient(to right, #9b59b6, #8e44ad);
            color: white;
        }

        .btn-home {
            background: linear-gradient(to right, #e74c3c, #c0392b);
            color: white;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .gold-seal {
            position: absolute;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
            width: 150px; /* Increased default size slightly */
            opacity: 0.8;
        }

        @media (max-width: 767px) {
            .certificate-container {
                padding: 1.5rem;
                border-width: 10px;
            }
            
            .certificate-title {
                font-size: 2rem;
            }
            
            .donor-name {
                font-size: 2.5rem;
            }
            
            .signature-image {
                width: 150px;
                height: 50px;
            }
            
            .gold-seal {
                width: 120px; /* Adjusted for smaller screens */
                right: 1rem;
                /* top: initial; */ /* Allow natural flow or adjust as needed */
                /* bottom: 1rem; */ /* Example positioning for smaller screens */
                /* transform: translateY(0); */
                top: 60%; /* Example fine-tuning */
                transform: translateY(-50%);
            }
            
            .action-button {
                padding: 0.7rem 1.2rem;
                font-size: 0.85rem;
            }
        }

        @media print {
            @page {
                size: A4 landscape; /* Changed to landscape for better fit */
                margin: 0.5cm; /* Added small margin for printing */
            }
            
            body {
                background: white !important;
                -webkit-print-color-adjust: exact !important; /* Ensures background colors and images print */
                print-color-adjust: exact !important;
            }
            
            .certificate-container {
                border: 15px solid #D4AF37 !important; /* Ensure border prints */
                border-image: linear-gradient(45deg, #D4AF37, #F4C430, #D4AF37) 1 !important; /* Ensure border image prints */
                box-shadow: none !important;
                page-break-after: avoid;
                page-break-inside: avoid;
                max-width: 98%; /* Ensure it fits within margins */
                margin: 0 auto;
            }
            
            .action-buttons {
                display: none !important;
            }

            .gold-seal { /* Ensure seal prints correctly */
                opacity: 1 !important; 
            }
        }
    </style>
</head>
<body>
    <div class="certificate-container" role="document" aria-labelledby="certificate-title" id="certificateToDownload">
        <img src="images/LOGO.png" alt="Sahajshakti Sarvakalyaan Trust Logo" class="logo-placeholder" onerror="this.src='https://placehold.co/120x80/E0E0E0/333333?text=SSST+Logo'; this.alt='Sahajshakti Sarvakalyaan Trust Logo Unavailable';">
        
        <h1 id="certificate-title" class="certificate-title">Certificate of Appreciation</h1>
        <div class="certificate-subtitle">Presented with Gratitude to</div>
        
        <span id="donorNamePlaceholder" class="donor-name" aria-label="Donor Name">Our Valued Donor</span>
        
        <div class="certificate-text">
            In deep appreciation of your generous contribution to Sahajshakti Sarvakalyaan Trust, we recognize your commitment to transforming lives. Your donation of <strong id="donationAmountInlineText">a generous amount</strong> directly supports our mission to provide quality education, healthcare, and vocational training to underserved communities across India.
        </div>
        
        <div id="donationAmountPlaceholder" class="donation-amount" aria-label="Donation Amount">a generous amount</div>
        
        
        <div class="certificate-text">
            Through your philanthropy, you are helping to break the cycle of poverty by empowering individuals with the tools they need to build sustainable livelihoods. Each rupee you've contributed represents hope, opportunity, and dignity for those we serve.
        </div>
        
        <div class="signature-container">
            <img id="signatureDisplay" src="images/signature.png" alt="Trustee Signature" class="signature-image" onerror="this.style.display='none';">
            <div class="signature-line"></div>
            <div class="ngo-name">Sahajshakti Sarvakalyaan Trust</div>
            <img src="images/stamp.png" alt="Official Seal" class="gold-seal" onerror="this.style.display='none';">
        </div>
        
        <div class="certificate-footer">
            <div class="certificate-footer-content">
                Certificate ID: <span id="certificateNumber">SSST-2025-</span><br>
                Date of Issue: <span id="issueDate" aria-label="Issue Date"></span><br>
                This certificate is awarded to <span id="donorNameFooter">Our Valued Donor</span> in recognition of their philanthropic contribution.
                <div id="paymentIdPlaceholder" class="payment-id-details" aria-label="Payment ID"></div>
            </div>
           
        </div>
        
        <div class="action-buttons">
            <button class="action-button btn-print" onclick="window.print()" aria-label="Print Certificate">
                Print Certificate
            </button>
            <button class="action-button btn-download" onclick="downloadCertificateAsImage()" aria-label="Download Certificate as Image">
                Download as Image
            </button>
            <button class="action-button btn-home" onclick="window.location.href='index.html'" aria-label="Back to Homepage">
                Back to Homepage
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            
            const donorNameParam = urlParams.get('donorName');
            const donorName = (donorNameParam && donorNameParam.trim() !== '' && donorNameParam !== 'null') ? decodeURIComponent(donorNameParam) : 'Our Valued Donor';
            
            const donationAmountParam = urlParams.get('donationAmount');
            const donationAmount = (donationAmountParam && donationAmountParam.trim() !== '' && donationAmountParam !== 'null') ? decodeURIComponent(donationAmountParam) : 'a generous amount';

            // Get Payment ID from URL
            const paymentIdParam = urlParams.get('paymentId');
            const paymentId = (paymentIdParam && paymentIdParam.trim() !== '' && paymentIdParam !== 'null') ? decodeURIComponent(paymentIdParam) : null;

            // Update all donor name elements
            const donorNameElements = [
                document.getElementById('donorNamePlaceholder'),
                // document.getElementById('donorNameInline'), // This ID was not found, using 'donorNamePlaceholder' for main display.
                document.getElementById('donorNameFooter')
            ];
            donorNameElements.forEach(el => {
                if (el) el.textContent = donorName;
            });

            // Update all donation amount elements
            const donationAmountElements = [
                document.getElementById('donationAmountPlaceholder'),
                document.getElementById('donationAmountInlineText') // Corrected ID to match HTML
                // document.getElementById('donationAmountFooter') // Removed as there's no specific footer element for amount
            ];
            donationAmountElements.forEach(el => {
                if (el) el.textContent = donationAmount;
            });

            // Update Payment ID placeholder
            const paymentIdElement = document.getElementById('paymentIdPlaceholder');
            if (paymentIdElement) {
                if (paymentId) {
                    paymentIdElement.textContent = `Payment ID: ${paymentId}`;
                    paymentIdElement.style.display = 'block'; // Ensure it's visible
                } else {
                    paymentIdElement.style.display = 'none'; // Hide if no Payment ID
                }
            }

            // Set issue date
            const issueDateElement = document.getElementById('issueDate');
            if (issueDateElement) {
                const today = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                issueDateElement.textContent = today.toLocaleDateString('en-US', options);
            }

            // Generate certificate number
            const certificateNumberElement = document.getElementById('certificateNumber');
            if (certificateNumberElement) {
                const randomNum = Math.floor(1000 + Math.random() * 9000);
                // Keep existing prefix and append random number
                const existingPrefix = certificateNumberElement.textContent; // e.g., "SSST-2025-"
                certificateNumberElement.textContent = `${existingPrefix}${randomNum}`;
            }

            // Corrected ID for inline donation amount text if needed:
            // The HTML has <strong id="donationAmountInlineText">
            // If you intended a different element for donor name inline, please ensure its ID is correct.
            // The provided HTML had "donationAmountInline" for the strong tag, which I've kept as "donationAmountInlineText" in the script's list
            // The list was: `document.getElementById('donationAmountInline')` -> changed to `document.getElementById('donationAmountInlineText')`
            // The donor name list had `document.getElementById('donorNameInline')` which was not present in the HTML; this item has been commented out from the list.
        });

        async function downloadCertificateAsImage() {
            const certificateElement = document.getElementById('certificateToDownload');
            if (!certificateElement) {
                console.error('Certificate element not found for download.');
                alert('Could not find the certificate element to download.');
                return;
            }

            const actionButtons = certificateElement.querySelector('.action-buttons');
            if (actionButtons) actionButtons.style.visibility = 'hidden';

            try {
                // Wait for fonts to be loaded, especially web fonts
                await document.fonts.ready; 
                
                const canvas = await html2canvas(certificateElement, {
                    scale: 3, // Higher scale for better quality
                    useCORS: true, // For loading cross-origin images if any (logo, seal)
                    logging: false, // Disable console logging from html2canvas
                    backgroundColor: '#FFFFFF', // Ensure a white background for the image
                    scrollX: 0, // Ensure it captures from the top-left
                    scrollY: 0,
                    windowWidth: certificateElement.scrollWidth,
                    windowHeight: certificateElement.scrollHeight
                });
                
                const link = document.createElement('a');
                link.download = `SSST_Certificate_of_Appreciation_${document.getElementById('donorNamePlaceholder').textContent.replace(/\s+/g, '_') || 'Donor'}.png`;
                link.href = canvas.toDataURL('image/png');
                document.body.appendChild(link); 
                link.click(); 
                document.body.removeChild(link);

            } catch (error) {
                console.error('Error generating certificate image:', error);
                alert('An error occurred while generating the certificate image. Please try printing or contact support.');
            } finally {
                if (actionButtons) actionButtons.style.visibility = 'visible';
            }
        }
    </script>
</body>
</html>